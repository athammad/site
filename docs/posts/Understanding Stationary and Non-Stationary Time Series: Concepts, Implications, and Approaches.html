<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ahmed T. Hammad - Understanding Stationary and Non-Stationary Time Series: Concepts, Implications, and Approaches</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Ahmed T. Hammad</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">ℹ️ About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teaching.html" rel="" target="">
 <span class="menu-text">🧑‍🏫 Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html" rel="" target="">
 <span class="menu-text">🛰 Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../students.html" rel="" target="">
 <span class="menu-text">🧑‍🎓 Students</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../papers.html" rel="" target="">
 <span class="menu-text">✍ Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../solutions.html" rel="" target="">
 <span class="menu-text">💡Solutions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../toolkits.html" rel="" target="">
 <span class="menu-text">🧰Toolkits</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv/cv.html" rel="" target="">
 <span class="menu-text">📃 CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../posts.html" rel="" target="">
 <span class="menu-text">🎙️Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html" rel="" target="">
 <span class="menu-text">📽️️ Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../gallery.html" rel="" target="">
 <span class="menu-text">📸 Gallery</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/athammad" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">Github</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/ahmedt-h/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text">LinkedIn</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:ahmed@decatab.com" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text">Email</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#stationary-time-series" id="toc-stationary-time-series" class="nav-link" data-scroll-target="#stationary-time-series">Stationary Time Series</a></li>
  <li><a href="#non-stationary-time-series" id="toc-non-stationary-time-series" class="nav-link" data-scroll-target="#non-stationary-time-series">Non-Stationary Time Series</a></li>
  <li><a href="#stationarity-drift-and-drift-detection-the-synonymy-of-non-stationarity-and-drift" id="toc-stationarity-drift-and-drift-detection-the-synonymy-of-non-stationarity-and-drift" class="nav-link" data-scroll-target="#stationarity-drift-and-drift-detection-the-synonymy-of-non-stationarity-and-drift">Stationarity, Drift, and Drift Detection: The Synonymy of Non-Stationarity and Drift</a>
  <ul class="collapse">
  <li><a href="#examples-of-drift-as-non-stationarity" id="toc-examples-of-drift-as-non-stationarity" class="nav-link" data-scroll-target="#examples-of-drift-as-non-stationarity">Examples of Drift as Non-Stationarity</a></li>
  <li><a href="#drift-detection-algorithms" id="toc-drift-detection-algorithms" class="nav-link" data-scroll-target="#drift-detection-algorithms">Drift Detection Algorithms</a></li>
  </ul></li>
  <li><a href="#addressing-non-stationarity-feature-engineering-in-machine-learning" id="toc-addressing-non-stationarity-feature-engineering-in-machine-learning" class="nav-link" data-scroll-target="#addressing-non-stationarity-feature-engineering-in-machine-learning">Addressing Non-Stationarity: Feature Engineering in Machine Learning</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Understanding Stationary and Non-Stationary Time Series: Concepts, Implications, and Approaches</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<div class="justify">
<p>Time series analysis is foundational in numerous fields, from economics and finance to engineering and the natural sciences. A time series is a sequence of observations indexed in time order, often taken at equally spaced intervals. Whether a time series is stationary or non-stationary significantly influences the methods and models that can be effectively applied to it. Understanding these concepts is crucial for extracting meaningful insights, especially when modeling complex real-world phenomena.</p>
</div>
<section id="stationary-time-series" class="level2">
<h2 class="anchored" data-anchor-id="stationary-time-series">Stationary Time Series</h2>
<div class="justify">
<p>A time series is considered stationary if its statistical properties, such as the mean, variance, and autocovariance, are invariant over time. More formally, a time series <span class="math inline">\(X_t\)</span> is strictly stationary if the joint probability distribution of any subset of the series remains unchanged when shifted in time. This implies that:</p>
<ul>
<li><strong>Mean</strong>: <span class="math inline">\(E(X_t) = \mu\)</span></li>
<li><strong>Variance</strong>: $Var(X_t) = ^2 $.</li>
<li><strong>Covariance</strong>: <span class="math inline">\(Cov(X_t, X_{t+k}) = \gamma(k)\)</span>, a function of the lag <span class="math inline">\(k\)</span> , but independent of time <span class="math inline">\(t\)</span>.</li>
</ul>
<p>A common relaxation of this definition is <strong>weak stationarity</strong>, which only requires the mean, variance, and autocovariance to be constant, not the entire distribution.</p>
<p>Stationarity is often a desirable property because many statistical models and forecasting techniques, such as autoregressive (AR) models, moving average (MA) models, and autoregressive integrated moving average (ARIMA) models, assume or require that the underlying time series is stationary. The stability of statistical properties allows for the derivation of consistent and meaningful parameter estimates, leading to reliable forecasts.</p>
<p>Mathematically, the simplest stationary process is white noise, where:</p>
<p><span class="math display">\[
X_t \sim N(0, \sigma^2) \quad \forall t
\]</span></p>
<p>Here, <span class="math inline">\(X_t\)</span> is normally distributed with a constant mean of 0 and variance <span class="math inline">\(\sigma^2\)</span>, and observations are uncorrelated over time.</p>
</div>
</section>
<section id="non-stationary-time-series" class="level2">
<h2 class="anchored" data-anchor-id="non-stationary-time-series">Non-Stationary Time Series</h2>
<div class="justify">
<p>In contrast, a time series is non-stationary if its statistical properties change over time. This can manifest in various ways:</p>
<ol type="1">
<li><strong>Changing Mean</strong>: The mean of the series may trend upward or downward over time.</li>
<li><strong>Changing Variance</strong>: The volatility of the series may increase or decrease.</li>
<li><strong>Seasonality</strong>: Regular patterns may repeat over time but do not correspond to constant parameters.</li>
</ol>
<p>A common example of non-stationarity is a <strong>random walk</strong>:</p>
<p><span class="math display">\[
X_t = X_{t-1} + \epsilon_t
\]</span></p>
<p>Here, <span class="math inline">\(\epsilon_t\)</span> is white noise. The random walk has no constant mean or variance; the variance grows with time, making it non-stationary. Despite its simplicity, this model underlies many economic and financial processes, such as stock prices.</p>
<p>Another form of non-stationarity is the presence of a <strong>unit root</strong>, where the characteristic equation of an autoregressive process has roots on the unit circle, i.e., $(B)X_t = _t $ with $(1) = 0 $. In such cases, shocks to the system have a permanent effect, preventing the series from reverting to a long-term mean.</p>
</div>
</section>
<section id="stationarity-drift-and-drift-detection-the-synonymy-of-non-stationarity-and-drift" class="level2">
<h2 class="anchored" data-anchor-id="stationarity-drift-and-drift-detection-the-synonymy-of-non-stationarity-and-drift">Stationarity, Drift, and Drift Detection: The Synonymy of Non-Stationarity and Drift</h2>
<div class="justify">
<p>Non-stationarity and drift are closely related concepts, often synonymous in time series analysis. Non-stationarity refers to changes in the statistical properties of a time series over time, while drift is a specific manifestation of this non-stationarity, typically as a systematic trend or shift in the data.</p>
<p>From a practical standpoint, drift is the real-world expression of non-stationarity. Drift occurs when there is a gradual shift in the time series’ mean, variance, or other characteristics. Whether this manifests as changes in performance, distribution of covariates, or even in the underlying functional relationship between input variables and the target outcome, drift is essentially the observable effect of non-stationarity.</p>
</div>
<section id="examples-of-drift-as-non-stationarity" class="level3">
<h3 class="anchored" data-anchor-id="examples-of-drift-as-non-stationarity">Examples of Drift as Non-Stationarity</h3>
<div class="justify">
<ol type="1">
<li><strong>Mean Drift</strong>: This occurs when a time series exhibits a trend, such as a gradual upward or downward movement over time, indicating that the series is non-stationary. Mathematically, this can be modeled as:</li>
</ol>
<p><span class="math display">\[
   X_t = \mu + \beta t + \epsilon_t
\]</span></p>
<p>Here, <span class="math inline">\(\beta\)</span> represents the drift term. The presence of such a trend means that the mean is not constant over time, leading to non-stationarity.</p>
<ol start="2" type="1">
<li><p><strong>Covariate Drift</strong>: When the distribution of covariates, or independent variables, changes over time, it introduces non-stationarity. For machine learning models, covariate drift can lead to degraded performance because the model’s assumptions about the data no longer hold.</p></li>
<li><p><strong>Performance Drift</strong>: In machine learning and predictive modeling, drift often manifests as a decline in performance over time. This occurs because the underlying data distribution, or the relationship between inputs and outputs, has shifted—another indication of non-stationarity.</p></li>
</ol>
<p>Since drift and non-stationarity are so closely linked, it is essential to continuously monitor for drift in time series data, especially in dynamic environments where the underlying data-generating process is expected to evolve over time. This is critical in virtually all real-world systems, such as financial markets, industrial IoT systems, or consumer behavior tracking, where maintaining model performance and accuracy is crucial.</p>
</div>
</section>
<section id="drift-detection-algorithms" class="level3">
<h3 class="anchored" data-anchor-id="drift-detection-algorithms">Drift Detection Algorithms</h3>
<div class="justify">
<p>Given the prevalence of drift in non-stationary systems, various drift detection algorithms have been developed to identify and react to these changes. Some of the most commonly used techniques include:</p>
<ol type="1">
<li><p><strong>CUSUM (Cumulative Sum Control Chart)</strong>: CUSUM monitors the cumulative sum of deviations from a target value, making it sensitive to small shifts in the mean.</p></li>
<li><p><strong>ADWIN (Adaptive Windowing)</strong>: ADWIN dynamically adjusts a sliding window to detect changes in data distributions. It works by comparing the distributions of data in two sub-windows and detecting changes when they become statistically distinct.</p></li>
<li><p><strong>Page-Hinkley Test</strong>: The Page-Hinkley test detects changes in the mean of a distribution by analyzing cumulative deviations from an estimated mean.</p></li>
</ol>
<p>These methods are particularly useful in environments where data evolves over time, as they can detect shifts early, allowing for timely adjustments to models and systems.</p>
</div>
</section>
</section>
<section id="addressing-non-stationarity-feature-engineering-in-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="addressing-non-stationarity-feature-engineering-in-machine-learning">Addressing Non-Stationarity: Feature Engineering in Machine Learning</h2>
<div class="justify">
<p>One effective way to handle non-stationary data in machine learning models is through careful feature engineering. Rather than transforming the time series to make it stationary, feature engineering allows the model to learn from the inherent variations in the data. This approach leverages domain-specific knowledge to create features that capture temporal patterns and trends, enabling the model to adapt to non-stationary conditions.</p>
<p>For example, in time series forecasting, creating features such as lagged values, moving averages, or rolling window statistics can help the model account for both short-term and long-term variations. Consider the creation of features like:</p>
<ul>
<li><strong>Lagged values</strong>: <span class="math inline">\(X_{t-1}, X_{t-2}, \dots\)</span> , which provide the model with recent history.</li>
<li><strong>Moving averages</strong>: Calculated over weeks or months to capture trends and smooth out noise.</li>
<li><strong>Rolling window statistics</strong>: Such as rolling standard deviations or medians, which can highlight changing volatility or patterns in the data.</li>
</ul>
<p>These engineered features allow machine learning models to implicitly handle non-stationarity by learning temporal dependencies and adapting to changes over time without explicitly forcing the series into a stationary form. Advanced models such as tree-based methods (e.g., XGBoost, Random Forests) and simple neuronal network architectures (e.g., MLP) benefit from such feature engineering, often capturing complex relationships and temporal dependencies.</p>
<p>By focusing on creating rich features that represent the underlying temporal dynamics, machine learning models can be robust to non-stationary data, making this an alternative approach to traditional time series modeling techniques that require stationarity.</p>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<div class="justify">
<p>In the real world, everything that varies over time is non-stationary. Whether it is a stock price, customer demand, or sensor data, non-stationarity is a pervasive feature of most systems. As such, understanding how to deal with non-stationarity is crucial for both statistical and machine learning models.</p>
<p>For classical time series analysis, stationarity is often a necessary condition, and transformations like differencing or seasonal decomposition are applied to achieve it. In contrast, machine learning models, with the aid of effective feature engineering, can often handle non-stationary data directly. By incorporating lagged variables, moving averages, and other temporal features, machine learning models can adapt to changes in data patterns without requiring explicit stationarity.</p>
<p>In business contexts, monitoring for drift is essential for ensuring that machine learning systems remain effective over time. As systems evolve, performance drift, covariate drift, and changes in the underlying functional relationships between variables need to be detected and managed. Addressing these challenges ensures that models continue to deliver reliable results in dynamic environments, making drift detection and management a critical part of any data-driven system.</p>
<p>Ultimately, the key to success in both classical time series analysis and machine learning is understanding the temporal nature of the data and selecting the appropriate techniques to handle its inherent non-stationarity.</p>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>